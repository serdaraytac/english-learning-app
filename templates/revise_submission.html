{% extends "base.html" %}
{% block title %}DÃ¼zeltme YÃ¼kle - English Learning{% endblock %}
{% block content %}
<div class="exercise-detail">
    <a href="{{ url_for('submission_result', submission_id=submission.id) }}" class="back-link">â† DeÄŸerlendirmeye DÃ¶n</a>
    
    <div class="exercise-header">
        <span class="level-badge level-{{ submission.exercises.level }}">{{ submission.exercises.level }}</span>
        <h1>DÃ¼zeltme YÃ¼kle</h1>
        <p class="revision-info">{{ revision_count + 1 }}. deneme</p>
    </div>

    <div class="instructions-box">
        <h2>ğŸ“‹ Orijinal GÃ¶rev</h2>
        <p>{{ submission.exercises.instructions }}</p>
    </div>

    {% if submission.evaluations %}
    <div class="errors-reminder">
        <h2>ğŸ” DÃ¼zeltmen Gereken Hatalar</h2>
        {% for err in submission.evaluations[0].errors_json %}
        <div class="error-item">
            <div class="error-original">âŒ {{ err.error | safe }}</div>
            <div class="error-hint">ğŸ’¡ {{ err.rule if err.rule else 'Ä°pucu iÃ§in Ã¶rneÄŸe bak' }}</div>
            <div class="error-example">ğŸ“ Ã–rnek: {{ err.example if err.example else 'YukarÄ±daki aÃ§Ä±klamaya gÃ¶re dÃ¼zelt' }}</div>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <div class="upload-section">
        <h2>ğŸ“¤ DÃ¼zeltilmiÅŸ Ã–devini YÃ¼kle</h2>
        <p>HatalarÄ± dÃ¼zelterek yeniden yaz ve fotoÄŸrafÄ±nÄ± Ã§ek.</p>
        
        <form method="POST" enctype="multipart/form-data" class="upload-form" id="uploadForm">
            <div class="file-upload">
                <input type="file" id="file" name="file" accept=".jpg,.jpeg,.png,.docx,.doc,.pdf" required>
                    <label for="file">
                        <span class="upload-icon">ğŸ“</span>
                        <span class="upload-text">Dosya seÃ§ veya sÃ¼rÃ¼kle</span>
                        <span class="upload-hint">JPG, PNG, Word veya PDF</span>
                    </label>
            </div>
            <div id="file-preview" class="file-preview"></div>
            <button type="submit" class="btn btn-primary" id="submitBtn">GÃ¶nder ve Tekrar DeÄŸerlendir</button>
        </form>
    </div>

    {% if revision_count >= 2 %}
    <div class="warning-box">
        <h3>ğŸ’¡ Ä°pucu</h3>
        <p>Bu 3. denemen. EÄŸer aynÄ± hatalar devam ediyorsa, o konuyu ayrÄ±ca Ã§alÄ±ÅŸman faydalÄ± olabilir.</p>
    </div>
    {% endif %}
</div>

<script>
document.getElementById('file').addEventListener('change', function(e) {
    const preview = document.getElementById('file-preview');
    const file = e.target.files[0];
    if (file) {
        preview.innerHTML = '<div class="file-info">âœ“ ' + file.name + ' (' + (file.size/1024).toFixed(1) + ' KB)</div>';
    }
});

document.getElementById('uploadForm').addEventListener('submit', function(e) {
    const btn = document.getElementById('submitBtn');
    btn.disabled = true;
    btn.innerHTML = '<span class="spinner-small"></span> YÃ¼kleniyor ve deÄŸerlendiriliyor...';
});
</script>
{% endblock %}
